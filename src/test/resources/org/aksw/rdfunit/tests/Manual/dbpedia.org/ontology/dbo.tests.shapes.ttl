@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix dbo-shape: <http://dbpedia.org/dbo-shape#> .

dbo-shape:
    rdfs:label "SHACL for DBpedia Ontology"@en ;
    rdfs:comment "This shapes graph is used to validate the DBpedia ontology commits. "@en ;
    sh:declare [
		  sh:prefix "rdfs" ;
		  sh:namespace "http://www.w3.org/2000/01/rdf-schema#"^^xsd:anyURI ;
	  ] ;
    sh:declare [
    	sh:prefix "owl" ;
    	sh:namespace "http://www.w3.org/2002/07/owl#"^^xsd:anyURI ;
    ] ;
    sh:declare [
    	sh:prefix "rdf" ;
    	sh:namespace "http://www.w3.org/1999/02/22-rdf-syntax-ns#"^^xsd:anyURI ;
    ] ;
    sh:declare [
    	sh:prefix "dbo" ;
    	sh:namespace "http://dbpedia.org/ontology/"^^xsd:anyURI ;
    ] .

dbo-shape:CheckClassesLabelsShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should have at least one rdfs:label" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE  {
              $this a owl:Class .
              FILTER NOT EXISTS {$this rdfs:label ?v1 }
            }""" ;
  ] .

dbo-shape:restrictTopClassesShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "DBpedia Ontology only allows 9 top level classes, any new top level classes need to be discussed here -link missing-" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?otherClass
            WHERE {
                  $this rdfs:subClassOf owl:Thing  .
                  FILTER NOT EXISTS {
                    $this rdfs:subClassOf ?otherClass .
                    FILTER(?otherClass != owl:Thing) .
                    FILTER(?otherClass != $this) .
                  }
                  FILTER($this NOT IN (
                    <http://dbpedia.org/ontology/Activity>,
                    <http://dbpedia.org/ontology/Agent>,
                    <http://dbpedia.org/ontology/Concept>,
                    <http://dbpedia.org/ontology/CommunicationSystem>,
                    <http://dbpedia.org/ontology/Condition>,
                    <http://dbpedia.org/ontology/Event>,
                    <http://dbpedia.org/ontology/PhysicalThing>,
                    <http://dbpedia.org/ontology/Place>,
                    <http://dbpedia.org/ontology/TimePeriod>)
                  ).
            } """ ;
    ] .

dbo-shape:CheckClassesLabelsShape2
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should not have more than one rdfs:label with the same language" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1 ?v2
            WHERE {
                  $this a owl:Class.
                  $this rdfs:label ?v1 .
                  $this rdfs:label ?v2 .
                  FILTER (str(?v1) != str(?v2) ) .
                  FILTER (lang(?v1) = lang(?v2)) .
            }""" ;
  ] .

dbo-shape:CheckClassesLabelsShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should have at least one rdfs:label" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE {
                  $this a owl:Class.
                  FILTER NOT EXISTS {$this rdfs:comment ?v1 }
            }""" ;
  ] .

dbo-shape:CheckClassesCommentsShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should have at least one rdfs:comment" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE  {
              $this a owl:Class .
              FILTER NOT EXISTS {$this rdfs:comment ?v1 }
            }""" ;
  ] .

dbo-shape:CheckClassesComments2Shape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should not have more than one rdfs:comment with the same language" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE {
                  $this a owl:Class.
                  $this rdfs:comment ?v1 .
                  $this rdfs:comment ?v2 .
                  FILTER (?v1 != ?v2 ) .
                  FILTER (lang(?v1) = lang(?v2)) .
            }""" ;
  ] .

dbo-shape:CheckClassesLabelsShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should have at least one rdfs:label" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE  {
              $this a owl:Class .
              FILTER NOT EXISTS {$this rdfs:label ?v1 }
            }""" ;
  ] .

dbo-shape:CheckClassesLabelsShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should have at least one rdfs:label" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE  {
              $this a owl:Class .
              FILTER NOT EXISTS {$this rdfs:label ?v1 }
            }""" ;
  ] .

dbo-shape:CheckClassesLabelsShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should have at least one rdfs:label" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE  {
              $this a owl:Class .
              FILTER NOT EXISTS {$this rdfs:label ?v1 }
            }""" ;
  ] .

dbo-shape:CheckClassesLabelsShape
  a sh:Shape ;
  sh:targetClass owl:Class ;
    sh:sparql [
        sh:message "Each owl:Class should have at least one rdfs:label" ;
        sh:severity sh:Warning ;
        sh:select """
            PREFIX owl: <http://www.w3.org/2002/07/owl#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            SELECT DISTINCT $this ?v1
            WHERE  {
              $this a owl:Class .
              FILTER NOT EXISTS {$this rdfs:label ?v1 }
            }""" ;
  ] .
